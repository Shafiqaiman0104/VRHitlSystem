<!DOCTYPE html>
<html>
<head>
  <title>MK HITL Console</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
    .chat-log { margin-bottom: 20px; max-height: 300px; overflow-y: auto; background: #fff; padding: 10px; border: 1px solid #ccc; }
    .chat-log div { margin: 5px 0; }
    #consoleLog { display: none; background: #000; color: #0f0; padding: 10px; height: 200px; overflow-y: auto; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>MK Admin Chat (HITL)</h2>
  <div class="chat-log" id="chat-log"></div>
  <input type="text" id="adminInput" placeholder="Type your reply..." />
  <button onclick="sendAdminMessage()">Send as Admin</button>
  <br><br>
  <button onclick="toggleConsole()">Toggle Console Log</button>
  <div id="consoleLog"></div>

  <script>
    const API_URL = "https://venturerush.up.railway.app/api/v1/bots/mk-ai-chatbot/converse/1c44773e-2ec6-4f3b-891d-cfa973e1a0c8";
    const AUTH_TOKEN = "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6InZlbnR1cmVydXNoLmNzQGdtYWlsLmNvbSIsInN0cmF0ZWd5IjoiZGVmYXVsdCIsInRva2VuVmVyc2lvbiI6MSwiaXNTdXBlckFkbWluIjp0cnVlLCJpYXQiOjE3NTQ1ODkxNjIsImV4cCI6MTc1NDU5Mjc2MiwiYXVkIjoiY29sbGFib3JhdG9ycyJ9.Yx27GHtHa05dE3-49OR0vXZQzhrkMyz0_u_H9gO1J80";

    const logConsole = (msg) => {
      const consoleDiv = document.getElementById("consoleLog");
      const line = document.createElement("div");
      line.textContent = `[${new Date().toISOString()}] ${msg}`;
      consoleDiv.appendChild(line);
      consoleDiv.scrollTop = consoleDiv.scrollHeight;
    };

    function toggleConsole() {
      const consoleDiv = document.getElementById("consoleLog");
      consoleDiv.style.display = consoleDiv.style.display === "none" ? "block" : "none";
    }

    function appendMessage(from, text) {
      const log = document.getElementById("chat-log");
      const msgDiv = document.createElement("div");
      msgDiv.innerHTML = `<strong>${from}:</strong> ${text}`;
      log.appendChild(msgDiv);
      log.scrollTop = log.scrollHeight;
    }

    async function sendAdminMessage() {
      const input = document.getElementById("adminInput");
      const text = input.value.trim();
      if (!text) return;

      appendMessage("Admin", text);
      input.value = "";

      try {
        logConsole("Sending admin message: " + text);
        const res = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": AUTH_TOKEN
          },
          body: JSON.stringify({
            type: "text",
            text
          })
        });

        const result = await res.json();
        logConsole("Status: " + res.status);
        logConsole("Response JSON: " + JSON.stringify(result));

        result.responses.forEach(response => {
          appendMessage("Bot", response.text || "[No text]");
        });
      } catch (err) {
        logConsole("Error: " + err.message);
        appendMessage("System", "‚ùå Error sending admin message");
      }
    }
  </script>
</body>
</html>
